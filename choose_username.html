<!doctype html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Vælg brugernavn</title>
<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body class="bg-gray-100 flex items-center justify-center h-screen">

<div class="bg-white p-6 rounded shadow max-w-sm w-full">
  <h1 class="text-xl font-bold mb-4 text-center">Vælg dit brugernavn</h1>

  <input
    id="usernameInput"
    type="text"
    placeholder="Fx Trampe123"
    class="border p-2 rounded w-full mb-3"
  >

  <button
    onclick="saveUsername()"
    class="bg-blue-600 text-white px-4 py-2 rounded w-full hover:bg-blue-700"
  >
    Gem brugernavn
  </button>

  <p id="error" class="text-red-600 text-sm mt-2"></p>
</div>

<script>
const firebaseConfig = {
  apiKey: "DIN_API_KEY",
  authDomain: "DIN_AUTH_DOMAIN",
  projectId: "DIN_PROJECT_ID",
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "gaet_login.html";
  }
});

async function saveUsername() {
  const username = document.getElementById("usernameInput").value.trim();
  const errorEl = document.getElementById("error");

  if (username.length < 3) {
    errorEl.textContent = "Brugernavn skal være mindst 3 tegn";
    return;
  }

  const user = auth.currentUser;
  if (!user) return;

  // ❗ Valgfrit: check for unikke brugernavne
  const existing = await db
    .collection("users")
    .where("username", "==", username)
    .get();

  if (!existing.empty) {
    errorEl.textContent = "Brugernavn er allerede taget";
    return;
  }

  await db.collection("users").doc(user.uid).set({
    email: user.email,
    username: username,
    createdAt: new Date()
  });

  window.location.href = "kampe.html";
}
</script>

</body>
</html>
