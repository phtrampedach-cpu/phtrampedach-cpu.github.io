<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Leaderboard</title>
<link rel="stylesheet" href="styles.css">
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100" onload="loadLeaderboardPage()">

<header>
  <nav class="menu-bar">
    <a href="index.html">Forside</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="leaderboard.html">Skift Liga</a>
    <a href="2Contact.html">Kontakt</a>
  </nav>
</header>

<div class="max-w-3xl mx-auto mt-6 bg-white p-6 rounded shadow">
    <h1 id="leagueTitle" class="text-2xl font-bold mb-4"></h1>

    <table class="w-full border-collapse text-left">
        <thead>
            <tr class="border-b bg-gray-100">
                <th class="p-2">Bruger</th>
                <th class="p-2">Point</th>
                <th class="p-2">Korrekt resultat</th>
                <th class="p-2">Korrekt udfald</th>
            </tr>
        </thead>
        <tbody id="leaderboardTable"></tbody>
    </table>
</div>

<script>
// Genbrug lokale funktioner fra leaderboard.html â€“ men kortere!

function getLeagues() {
    return JSON.parse(localStorage.getItem("miniLeagues") || "[]");
}

function getMatches() {
    return JSON.parse(localStorage.getItem("kampData") || "[]");
}

function getUserResults() {
    return JSON.parse(localStorage.getItem("userGuesses") || "{}");
}

// Samme beregning som du allerede har:
function calculateUserStats(username) {
    const guesses = getUserResults()[username] || {};
    const matches = getMatches();

    let point = 0, correctResult = 0, correctOutcome = 0;

    matches.forEach(m => {
        if (m.homeGoals == null || m.awayGoals == null) return;
        if (!guesses[m.id]) return;

        const g = guesses[m.id];
        const exact = g.homeGoals == m.homeGoals && g.awayGoals == m.awayGoals;
        const outcomeCorrect =
            (m.homeGoals > m.awayGoals && g.homeGoals > g.awayGoals) ||
            (m.homeGoals < m.awayGoals && g.homeGoals < g.awayGoals) ||
            (m.homeGoals == m.awayGoals && g.homeGoals == g.awayGoals);

        if (exact) {
            point += 3;
            correctResult++;
        } else if (outcomeCorrect) {
            point += 1;
            correctOutcome++;
        }
    });

    return { username, point, correctResult, correctOutcome };
}

function loadLeaderboardPage() {
    const leagueName = localStorage.getItem("currentLeague");
    if (!leagueName) {
        window.location.href = "leaderboard.html";
        return;
    }

    const leagues = getLeagues();
    const league = leagues.find(l => l.name === leagueName);

    document.getElementById("leagueTitle").innerText = "Liga: " + leagueName;

    const stats = league.users.map(u => calculateUserStats(u));
    stats.sort((a, b) => b.point - a.point);

    const tbody = document.getElementById("leaderboardTable");
    tbody.innerHTML = "";

    stats.forEach(s => {
        const tr = document.createElement("tr");
        tr.className = "border-b";
        tr.innerHTML = `
            <td class="p-2 font-semibold">${s.username}</td>
            <td class="p-2">${s.point}</td>
            <td class="p-2">${s.correctResult}</td>
            <td class="p-2">${s.correctOutcome}</td>
        `;
        tbody.appendChild(tr);
    });
}
</script>

<style>
.menu-bar {
  display: flex;
  justify-content: center;
  background-color: #007bff;
  padding: 10px;
  gap: 15px;
}
.menu-bar a {
  color: white;
  font-weight: bold;
  text-decoration: none;
}
.menu-bar a:hover {
  text-decoration: underline;
}
</style>

</body>
</html>
