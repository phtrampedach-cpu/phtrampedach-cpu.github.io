<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin – Kampstyring</title>
<link rel="stylesheet" href="styles.css">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body class="bg-gray-100">

<header>
  <nav class="menu-bar">
    <a href="1Forside.html">Forside</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="leaderboard.html">Leaderboard</a>
    <a href="admin.html" id="admin-link" style="display:none;">Admin</a>
    <a href="2Contact.html">Kontakt</a>
  </nav>
</header>

<main class="max-w-4xl mx-auto bg-white mt-8 p-6 rounded-lg shadow">
  <h1 class="text-3xl font-bold mb-4 text-center">Admin – Kampstyring</h1>

  <!-- Turnering filter -->
  <div class="flex justify-center gap-3 mb-4" id="tournament-selector">
    <button data-tournament="VM2026" class="tournament-btn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">VM 2026</button>
    <button data-tournament="Superliga" class="tournament-btn bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Superliga Forår 2026</button>
    <button data-tournament="PremierLeague" class="tournament-btn bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Premier League Forår 2026</button>
  </div>

  <!-- Gem alle kampe -->
  <div class="flex justify-center gap-3 mb-4">
    <button id="save-all" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Gem alle kampe</button>
    <button id="import-btn" onclick="importMatches()" style="display:none;" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Importer alle kampe</button>
  </div>

  <div id="save-notice" class="hidden text-green-700 font-semibold mb-2 text-center"></div>

  <!-- Kampe visning -->
  <div id="kampe-container" class="space-y-4"></div>
</main>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBQBoHOBENQHP20J7pv1kkEs2gTd7r_flg",
  authDomain: "trampestips.firebaseapp.com",
  projectId: "trampestips",
  storageBucket: "trampestips.firebasestorage.app",
  messagingSenderId: "759235788489",
  appId: "1:759235788489:web:9515bc438a7c7d68469718",
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const ADMIN_EMAIL = "P.H.Trampedach@gmail.com";
let currentUser = null;
let selectedTournament = "VM2026";

// ===== Check login =====
auth.onAuthStateChanged(async (user) => {
  if(!user) { window.location.href = "gaet_login.html"; return; }
  currentUser = user;

  // Kun admin kan se admin-link og import-knap
  if(currentUser.email === ADMIN_EMAIL){
    document.getElementById("admin-link").style.display = "inline-block";
    document.getElementById("import-btn").style.display = "inline-block";
  } else {
    window.location.href = "1Forside.html"; // andre kan ikke se admin
  }

  await loadKampe();
});

// ===== Turnering filter =====
document.querySelectorAll('.tournament-btn').forEach(btn=>{
  btn.addEventListener('click', async ()=>{
    selectedTournament = btn.dataset.tournament;

    document.querySelectorAll('.tournament-btn').forEach(b=>{
      if(b===btn){
        b.classList.remove('bg-gray-300','text-gray-800');
        b.classList.add('bg-blue-600','text-white');
      } else {
        b.classList.remove('bg-blue-600','text-white');
        b.classList.add('bg-gray-300','text-gray-800');
      }
    });

    await loadKampe();
  });
});

// ===== Load kampe =====
async function loadKampe() {
  const kampeContainer = document.getElementById("kampe-container");
  kampeContainer.innerHTML = `<p class="text-center text-gray-500">Indlæser kampe...</p>`;

  const matchesSnap = await db.collection("matches")
                              .where("tournament","==",selectedTournament)
                              .orderBy("date").get();

  kampeContainer.innerHTML = "";

  matchesSnap.forEach(doc=>{
    const match = doc.data();
    const matchDiv = document.createElement("div");
    matchDiv.className = "p-3 rounded-lg border border-gray-300 shadow-md kamp";
    matchDiv.dataset.matchId = doc.id;
    matchDiv.innerHTML = `
      <div class="flex justify-between items-center gap-2">
        <span>${match.homeTeam} vs ${match.awayTeam}</span>
        <span>${match.date} ${match.time}</span>
        <input type="number" placeholder="Hjemme mål" class="homeGoals border rounded w-12 text-center" value="${match.homeGoals??''}">
        <input type="number" placeholder="Ude mål" class="awayGoals border rounded w-12 text-center" value="${match.awayGoals??''}">
      </div>
    `;
    kampeContainer.appendChild(matchDiv);
  });
}

// ===== Gem alle kampe én ad gangen =====
document.getElementById("save-all").addEventListener("click", async ()=>{
  const kampDivs = document.querySelectorAll('.kamp');
  const notice = document.getElementById("save-notice");
  
  notice.textContent = "Opdaterer kampene…";
  notice.classList.remove("hidden");

  for(const div of kampDivs){
    const matchId = div.dataset.matchId;
    const homeGoals = Number(div.querySelector('.homeGoals').value);
    const awayGoals = Number(div.querySelector('.awayGoals').value);

    try{
      await db.collection("matches").doc(matchId).update({ homeGoals, awayGoals });
    } catch(err){
      console.error(`Fejl ved opdatering af kamp ${matchId}:`, err);
    }
  }

  notice.textContent = "Alle kampe er opdateret!";
  setTimeout(()=>notice.classList.add("hidden"), 3000);
});

// ===== Import kampene (opdelt) =====
async function importMatches(){
  const vmMatches=[ /* her indsættes VM kampe */ ];
  const superligaMatches=[ /* her indsættes Superliga kampe */ ];
  const premierLeagueMatches=[ /* her indsættes Premier League kampe */ ];

  const allMatches = [...vmMatches, ...superligaMatches, ...premierLeagueMatches];

  for(const match of allMatches){
    await db.collection("matches").doc(match.id).set(match);
  }

  const notice = document.getElementById("save-notice");
  notice.textContent = `Alle ${allMatches.length} kampe er importeret!`;
  notice.classList.remove("hidden");
  setTimeout(()=>notice.classList.add("hidden"), 3000);

  await loadKampe();
}
</script>

<style>
.menu-bar {
  display: flex;
  justify-content: center;
  background-color: #007bff;
  padding: 10px;
  gap: 15px;
}
.menu-bar a {
  color: white;
  font-weight: bold;
  text-decoration: none;
}
.menu-bar a:hover, .menu-bar a.active {
  text-decoration: underline;
}
</style>

</body>
</html>
