<main class="max-w-4xl mx-auto bg-white mt-8 p-6 rounded-lg shadow">
  <h1 class="text-3xl font-bold mb-4 text-center">Admin – Kampe</h1>

  <!-- Turnering filter -->
  <div class="flex justify-center gap-3 mb-4" id="tournament-filter">
    <button data-tournament="VM2026" class="tournament-btn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">VM 2026</button>
    <button data-tournament="Superliga" class="tournament-btn bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Superliga</button>
    <button data-tournament="PremierLeague" class="tournament-btn bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Premier League</button>
  </div>

  <!-- Import og gem -->
  <div class="flex justify-center gap-3 mb-4">
    <button id="save-all" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Gem alle gæt</button>
    <button id="import-btn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Importer alle kampe</button>
  </div>

  <div id="save-notice" class="hidden text-green-700 font-semibold mb-2 text-center"></div>

  <div id="kampe-container" class="space-y-4"></div>
</main>

<script>
let selectedTournament = "VM2026"; // default

// Turnering filter
document.querySelectorAll('#tournament-filter .tournament-btn').forEach(btn => {
  btn.addEventListener('click', async () => {
    selectedTournament = btn.dataset.tournament;

    // style knapper
    document.querySelectorAll('#tournament-filter .tournament-btn').forEach(b => {
      if (b === btn) {
        b.classList.remove('bg-gray-300','text-gray-800');
        b.classList.add('bg-blue-600','text-white');
      } else {
        b.classList.remove('bg-blue-600','text-white');
        b.classList.add('bg-gray-300','text-gray-800');
      }
    });

    await loadKampe();
  });
});

// Load kampe
async function loadKampe() {
  const kampeContainer = document.getElementById("kampe-container");
  kampeContainer.innerHTML = `<p class="text-center text-gray-500">Indlæser kampe...</p>`;

  const matchesSnap = await db.collection("matches")
                              .where("tournament","==",selectedTournament)
                              .orderBy("date").get();

  kampeContainer.innerHTML = "";

  matchesSnap.forEach(doc => {
    const match = doc.data();
    const matchDiv = document.createElement("div");
    matchDiv.className = "p-3 rounded-lg border border-gray-300 shadow-md kamp";
    matchDiv.innerHTML = `
      <div class="flex justify-between items-center">
        <span>${match.homeTeam} vs ${match.awayTeam}</span>
        <span>${match.date} ${match.time}</span>
        <input type="number" placeholder="Hjemme mål" class="homeGoals border rounded w-12 text-center" value="${match.homeGoals??''}">
        <input type="number" placeholder="Ude mål" class="awayGoals border rounded w-12 text-center" value="${match.awayGoals??''}">
      </div>
    `;
    matchDiv.dataset.matchId = doc.id;
    kampeContainer.appendChild(matchDiv);
  });
}

// Gem alle kampe (admin)
document.getElementById("save-all").addEventListener("click", async () => {
  const kampDivs = document.querySelectorAll('.kamp');
  const batch = [];

  kampDivs.forEach(div => {
    const matchId = div.dataset.matchId;
    const homeGoals = Number(div.querySelector('.homeGoals').value);
    const awayGoals = Number(div.querySelector('.awayGoals').value);

    batch.push(db.collection("matches").doc(matchId).update({
      homeGoals,
      awayGoals
    }));
  });

  await Promise.all(batch);

  const notice = document.getElementById("save-notice");
  notice.textContent = "Alle kampe er gemt!";
  notice.classList.remove("hidden");
  setTimeout(() => notice.classList.add("hidden"), 2000);
});

// Initial load
loadKampe();
</script>
