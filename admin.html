<!doctype html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Kampstyring</title>
<link rel="stylesheet" href="styles.css">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-100">

<header>
  <nav class="menu-bar">
    <a href="dashboard.html">Dashboard</a>
    <a href="gaet.html">Gæt på kampe</a>
    <a href="leaderboard.html">Leaderboard</a>
  </nav>
</header>

<main class="max-w-4xl mx-auto bg-white mt-8 p-6 rounded-lg shadow">
  <h1 class="text-3xl font-bold mb-4 text-center">Admin: Kampstyring</h1>

  <div class="flex justify-center gap-3 mb-4" id="tournament-selector">
    <button data-tournament="VM2026" class="tournament-btn bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">VM 2026</button>
    <button data-tournament="Superliga" class="tournament-btn bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Superliga Forår 2026</button>
    <button data-tournament="PremierLeague" class="tournament-btn bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Premier League Forår 2026</button>
  </div>

  <div class="flex justify-center gap-3 mb-4">
    <button id="import-btn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Importer kampe</button>
  </div>

  <div id="save-notice" class="hidden text-green-700 font-semibold mb-2 text-center"></div>

  <div id="kampe-container" class="space-y-4"></div>
</main>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBQBoHOBENQHP20J7pv1kkEs2gTd7r_flg",
  authDomain: "trampestips.firebaseapp.com",
  projectId: "trampestips",
  storageBucket: "trampestips.firebasestorage.app",
  messagingSenderId: "759235788489",
  appId: "1:759235788489:web:9515bc438a7c7d68469718",
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const ADMIN_EMAIL = "p.h.trampedach@gmail.com";
const kampeContainer = document.getElementById("kampe-container");
let currentUser = null;
let selectedTournament = "VM2026";

// Flags til teams
const flags = {
  "Danmark":"Billeder/danmark.png",
  "Tyskland":"Billeder/tyskland.png",
  "England":"Billeder/england.png",
  "Frankrig":"Billeder/frankrig.png",
  "Japan":"Billeder/japan.png",
  "Kroatien":"Billeder/kroatien.png",
  "Norge":"Billeder/norge.png",
  "Portugal":"Billeder/portugal.png",
  "FCK":"Billeder/fck.png",
  "FC Midtjylland":"Billeder/fcm.png",
  "Manchester United":"Billeder/manu.png",
  "Chelsea":"Billeder/chelsea.png",
};

// ===== Check login =====
auth.onAuthStateChanged(async (user) => {
  if (!user || user.email !== ADMIN_EMAIL) {
    window.location.href = "gaet_login.html";
    return;
  }
  currentUser = user;
  await loadKampe();
});

// ===== Turnering valg =====
document.querySelectorAll('.tournament-btn').forEach(btn => {
  btn.addEventListener('click', async () => {
    selectedTournament = btn.dataset.tournament;
    document.querySelectorAll('.tournament-btn').forEach(b => {
      b.classList.remove('bg-blue-600','text-white');
      b.classList.add('bg-gray-300','text-gray-800');
    });
    btn.classList.add('bg-blue-600','text-white');
    await loadKampe();
  });
});

// ===== Load kampe =====
async function loadKampe() {
  kampeContainer.innerHTML = `<p class="text-center text-gray-500">Indlæser kampe...</p>`;
  const matchesSnap = await db.collection("matches")
                              .where("tournament","==",selectedTournament)
                              .orderBy("date").get();

  kampeContainer.innerHTML = "";

  matchesSnap.forEach(doc => {
    const match = {id: doc.id, ...doc.data()};

    const kampDiv = document.createElement("div");
    kampDiv.className = "p-3 rounded-lg border border-gray-300 shadow-md kamp";
    kampDiv.dataset.matchId = match.id;
    kampDiv.innerHTML = `
      <div class="flex items-center justify-between gap-4">
        <img src="${flags[match.homeTeam]}" class="w-8 h-8">
        <span class="font-semibold">${match.homeTeam}</span>
        <input type="number" min="0" class="homeGoals border rounded w-12 text-center" value="${match.homeGoals ?? ''}">

        <span class="font-bold text-xl">vs</span>

        <input type="number" min="0" class="awayGoals border rounded w-12 text-center" value="${match.awayGoals ?? ''}">
        <span class="font-semibold">${match.awayTeam}</span>
        <img src="${flags[match.awayTeam]}" class="w-8 h-8">

        <span class="text-sm text-gray-500 ml-4">${match.date} ${match.time}</span>
      </div>

      <div class="mt-2 flex justify-end gap-2">
        <button class="save-match bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">Gem kamp</button>
      </div>
    `;
    kampeContainer.appendChild(kampDiv);
  });

  // Tilføj click event til alle "Gem kamp" knapper
  document.querySelectorAll(".save-match").forEach(btn => {
    btn.addEventListener("click", async (e) => {
      const kampDiv = e.target.closest(".kamp");
      const matchId = kampDiv.dataset.matchId;
      const homeGoals = Number(kampDiv.querySelector(".homeGoals").value);
      const awayGoals = Number(kampDiv.querySelector(".awayGoals").value);

      await db.collection("matches").doc(matchId).update({ homeGoals, awayGoals });

      await updateLeaderboardForMatch(matchId);

      const notice = document.getElementById("save-notice");
      notice.textContent = `Kamp ${matchId} er gemt og leaderboard opdateret!`;
      notice.classList.remove("hidden");
      setTimeout(() => notice.classList.add("hidden"), 2000);

      // Genindlæs kampe for at låse inputs (valgfrit)
      await loadKampe();
    });
  });
}

// ===== Import kampe =====
document.getElementById("import-btn").addEventListener("click", async () => {
  // Her kan du genbruge importMatches fra gæt-fanen
  await importMatches(); 
});
</script>

</body>
</html>
