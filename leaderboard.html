<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leaderboard</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body class="bg-gray-100">

<header>
  <nav class="menu-bar">
    <a href="1Forside.html">Forside</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="leaderboard.html" class="active">Leaderboard</a>
    <a href="2Contact.html">Kontakt</a>
  </nav>
</header>

<main class="max-w-4xl mx-auto mt-8 p-6 bg-white shadow rounded-lg">

  <h1 class="text-3xl font-bold text-center mb-6">Leaderboard</h1>

  <div class="flex justify-center mb-4">
    <select id="tournamentFilter" class="border px-3 py-2 rounded">
      <option value="">Vælg turnering...</option>
      <option value="VM2026">VM 2026</option>
      <option value="Superliga">Superliga Forår 2026</option>
      <option value="PremierLeague">Premier League Forår 2026</option>
    </select>
  </div>

  <div id="loading" class="text-center text-gray-500">Indlæser leaderboard...</div>

  <table class="w-full border-collapse hidden" id="leaderboard-table">
    <thead>
      <tr class="bg-gray-200 border-b">
        <th class="p-3 text-left">Placering</th>
        <th class="p-3 text-left">Bruger</th>
        <th class="p-3 text-left">Point</th>
        <th class="p-3 text-left">Korrekt resultat</th>
        <th class="p-3 text-left">Korrekt udfald</th>
      </tr>
    </thead>
    <tbody id="leaderboard-body"></tbody>
  </table>

</main>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBQBoHOBENQHP20J7pv1kkEs2gTd7r_flg",
  authDomain: "trampestips.firebaseapp.com",
  projectId: "trampestips",
  storageBucket: "trampestips.firebasestorage.app",
  messagingSenderId: "759235788489",
  appId: "1:759235788489:web:9515bc438a7c7d68469718",
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const tournamentFilter = document.getElementById("tournamentFilter");
const leaderboardBody = document.getElementById("leaderboard-body");
const table = document.getElementById("leaderboard-table");
const loading = document.getElementById("loading");

// Auth check
auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "gaet_login.html";
    return;
  }
});

// Load leaderboard når dropdown ændres
tournamentFilter.addEventListener("change", () => {
  const tournament = tournamentFilter.value;
  if (!tournament) return;

  loadLeaderboard(tournament);
});

async function loadLeaderboard(tournament) {
  leaderboardBody.innerHTML = "";
  loading.classList.remove("hidden");
  table.classList.add("hidden");

  try {
    const usersSnap = await db.collection("leaderboards")
                              .doc(tournament)
                              .collection("users")
                              .get();

    const leaderboard = usersSnap.docs.map(doc => ({
      username: doc.data().username,
      points: doc.data().points ?? 0,
      correctResult: doc.data().correctResult ?? 0,
      correctOutcome: doc.data().correctOutcome ?? 0
    }));

    // Sorter efter points
    leaderboard.sort((a, b) => b.points - a.points);

    leaderboard.forEach((u, index) => {
      const tr = document.createElement("tr");
      tr.className = "border-b";
      tr.innerHTML = `
        <td class="p-3 font-semibold">${index + 1}</td>
        <td class="p-3">${u.username}</td>
        <td class="p-3 font-bold">${u.points}</td>
        <td class="p-3">${u.correctResult}</td>
        <td class="p-3">${u.correctOutcome}</td>
      `;
      leaderboardBody.appendChild(tr);
    });

    loading.classList.add("hidden");
    table.classList.remove("hidden");

  } catch (err) {
    console.error("Fejl ved indlæsning af leaderboard:", err);
    loading.textContent = "Fejl ved indlæsning af leaderboard.";
  }
}
</script>

<style>
.menu-bar {
  display: flex;
  justify-content: center;
  background-color: #007bff;
  padding: 10px;
  gap: 15px;
}
.menu-bar a {
  color: white;
  font-weight: bold;
  text-decoration: none;
}
.menu-bar a:hover, .menu-bar a.active {
  text-decoration: underline;
}
</style>

</body>
</html>
